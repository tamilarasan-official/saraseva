<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>SaralSeva AI – Document Checker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .upload-zone {
            transition: all 0.3s ease;
            border: 2px dashed #cbd5e1;
        }
        
        .upload-zone:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.01);
        }
        
        .upload-zone.drag-over {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        .file-item {
            animation: slideIn 0.3s ease;
            transition: all 0.3s ease;
        }
        
        .file-item:hover {
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 min-h-screen">

    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-2xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <div class="bg-white bg-opacity-20 p-2 rounded-lg backdrop-blur">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
                    </div>
                    <div class="leading-tight">
                        <h1 class="text-base sm:text-xl font-bold">SaralSeva AI – Document Check</h1>
                        <p class="text-[10px] sm:text-xs text-white/80 hidden sm:block">Verify your documents instantly</p>
                    </div>
                </div>
                <a href="home.html" class="text-xs sm:text-sm bg-white bg-opacity-20 px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg hover:bg-opacity-30 transition backdrop-blur font-medium">
          ← Back
        </a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8">

        <!-- Welcome Section -->
        <div class="mb-6 sm:mb-8 animate-fadeInUp">
            <h2 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">Document Verification</h2>
            <p class="text-sm sm:text-base text-gray-600">Upload your documents for instant verification</p>
        </div>

        <div class="bg-white/90 backdrop-blur-xl shadow-2xl rounded-2xl sm:rounded-3xl p-6 sm:p-8 space-y-6 border border-white/20 animate-fadeInUp" style="animation-delay: 0.1s;">
            <div class="text-center mb-4 sm:mb-6">
                <h3 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Upload Documents</h3>
                <p class="text-sm sm:text-base text-gray-600">Upload your identity documents for verification</p>
            </div>

            <!-- Document Cards Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">

                <!-- Aadhar Card -->
                <div class="document-card bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-4 sm:p-6 border-2 border-blue-200 shadow-lg hover:shadow-xl transition">
                    <div class="flex items-center justify-between mb-3 sm:mb-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-blue-700 rounded-xl flex items-center justify-center shadow-md">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"/>
                </svg>
                            </div>
                            <div>
                                <h4 class="text-base sm:text-lg font-bold text-gray-800">Aadhar Card</h4>
                                <p class="text-xs sm:text-sm text-gray-600">Identity Proof</p>
                            </div>
                        </div>
                        <div id="aadharBadge" class="stats-badge bg-blue-600 text-white px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-bold shadow">
                            4
                        </div>
                    </div>
                    <div class="upload-zone-small bg-white/80 backdrop-blur border-2 border-dashed border-blue-300 rounded-xl p-4 sm:p-6 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50/50 transition" data-doc="aadhar">
                        <input type="file" accept=".pdf,.jpg,.jpeg,.png" class="hidden doc-input" id="aadharInput" />
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 mx-auto mb-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
                        <button type="button" class="upload-btn bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 sm:px-6 py-2 rounded-lg font-semibold text-xs sm:text-sm hover:shadow-lg transform hover:scale-105 transition">
              Choose Files
            </button>
                        <p class="text-xs text-gray-500 mt-2">or drag and drop</p>
                        <p class="text-[10px] text-gray-400 mt-1">PDF, JPG, PNG (Max 10MB)</p>
                    </div>
                    <div class="file-preview mt-3 text-xs sm:text-sm text-gray-700 font-medium" id="aadharPreview"></div>
                </div>

                <!-- PAN Card -->
                <div class="document-card bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-4 sm:p-6 border-2 border-green-200 shadow-lg hover:shadow-xl transition">
                    <div class="flex items-center justify-between mb-3 sm:mb-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-green-500 to-green-700 rounded-xl flex items-center justify-center shadow-md">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                            </div>
                            <div>
                                <h4 class="text-base sm:text-lg font-bold text-gray-800">PAN Card</h4>
                                <p class="text-xs sm:text-sm text-gray-600">Tax Identity</p>
                            </div>
                        </div>
                        <div id="panBadge" class="stats-badge bg-green-600 text-white px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-bold shadow">
                            4
                        </div>
                    </div>
                    <div class="upload-zone-small bg-white/80 backdrop-blur border-2 border-dashed border-green-300 rounded-xl p-4 sm:p-6 text-center cursor-pointer hover:border-green-500 hover:bg-green-50/50 transition" data-doc="pan">
                        <input type="file" accept=".pdf,.jpg,.jpeg,.png" class="hidden doc-input" id="panInput" />
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 mx-auto mb-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
                        <button type="button" class="upload-btn bg-gradient-to-r from-green-500 to-green-600 text-white px-4 sm:px-6 py-2 rounded-lg font-semibold text-xs sm:text-sm hover:shadow-lg transform hover:scale-105 transition">
              Choose Files
            </button>
                        <p class="text-xs text-gray-500 mt-2">or drag and drop</p>
                        <p class="text-[10px] text-gray-400 mt-1">PDF, JPG, PNG (Max 10MB)</p>
                    </div>
                    <div class="file-preview mt-3 text-xs sm:text-sm text-gray-700 font-medium" id="panPreview"></div>
                </div>

                <!-- Voter ID -->
                <div class="document-card bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-4 sm:p-6 border-2 border-purple-200 shadow-lg hover:shadow-xl transition">
                    <div class="flex items-center justify-between mb-3 sm:mb-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl flex items-center justify-center shadow-md">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
                            </div>
                            <div>
                                <h4 class="text-base sm:text-lg font-bold text-gray-800">Voter ID</h4>
                                <p class="text-xs sm:text-sm text-gray-600">Electoral Identity</p>
                            </div>
                        </div>
                        <div id="voterBadge" class="stats-badge bg-purple-600 text-white px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-bold shadow">
                            4
                        </div>
                    </div>
                    <div class="upload-zone-small bg-white/80 backdrop-blur border-2 border-dashed border-purple-300 rounded-xl p-4 sm:p-6 text-center cursor-pointer hover:border-purple-500 hover:bg-purple-50/50 transition" data-doc="voter">
                        <input type="file" accept=".pdf,.jpg,.jpeg,.png" class="hidden doc-input" id="voterInput" />
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 mx-auto mb-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
                        <button type="button" class="upload-btn bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 sm:px-6 py-2 rounded-lg font-semibold text-xs sm:text-sm hover:shadow-lg transform hover:scale-105 transition">
              Choose Files
            </button>
                        <p class="text-xs text-gray-500 mt-2">or drag and drop</p>
                        <p class="text-[10px] text-gray-400 mt-1">PDF, JPG, PNG (Max 10MB)</p>
                    </div>
                    <div class="file-preview mt-3 text-xs sm:text-sm text-gray-700 font-medium" id="voterPreview"></div>
                </div>

                <!-- Ration Card -->
                <div class="document-card bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl p-4 sm:p-6 border-2 border-orange-200 shadow-lg hover:shadow-xl transition">
                    <div class="flex items-center justify-between mb-3 sm:mb-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-orange-500 to-orange-700 rounded-xl flex items-center justify-center shadow-md">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                </svg>
                            </div>
                            <div>
                                <h4 class="text-base sm:text-lg font-bold text-gray-800">Ration Card</h4>
                                <p class="text-xs sm:text-sm text-gray-600">Food Security</p>
                            </div>
                        </div>
                        <div id="rationBadge" class="stats-badge bg-orange-600 text-white px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-bold shadow">
                            4
                        </div>
                    </div>
                    <div class="upload-zone-small bg-white/80 backdrop-blur border-2 border-dashed border-orange-300 rounded-xl p-4 sm:p-6 text-center cursor-pointer hover:border-orange-500 hover:bg-orange-50/50 transition" data-doc="ration">
                        <input type="file" accept=".pdf,.jpg,.jpeg,.png" class="hidden doc-input" id="rationInput" />
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 mx-auto mb-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
                        <button type="button" class="upload-btn bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 sm:px-6 py-2 rounded-lg font-semibold text-xs sm:text-sm hover:shadow-lg transform hover:scale-105 transition">
              Choose Files
            </button>
                        <p class="text-xs text-gray-500 mt-2">or drag and drop</p>
                        <p class="text-[10px] text-gray-400 mt-1">PDF, JPG, PNG (Max 10MB)</p>
                    </div>
                    <div class="file-preview mt-3 text-xs sm:text-sm text-gray-700 font-medium" id="rationPreview"></div>
                </div>

            </div>

            <button id="checkBtn" type="button" class="hidden w-full bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white px-6 py-3 sm:py-4 rounded-xl text-base sm:text-lg font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-100 transition disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Verify All Documents
      </button>

            <div id="statusMsg" class="text-center text-sm sm:text-base font-medium"></div>
        </div>

    </main>

    <script>
        const checkBtn = document.getElementById("checkBtn");
        const statusMsg = document.getElementById("statusMsg");
        const uploadedDocs = {
            aadhar: null,
            pan: null,
            voter: null,
            ration: null
        };

        // Setup upload zones
        document.querySelectorAll('.upload-zone-small').forEach(zone => {
            const docType = zone.getAttribute('data-doc');
            const input = document.getElementById(`${docType}Input`);
            const preview = document.getElementById(`${docType}Preview`);
            const uploadBtn = zone.querySelector('.upload-btn');

            // Click to upload
            uploadBtn.onclick = (e) => {
                e.stopPropagation();
                input.click();
            };

            zone.onclick = () => input.click();

            // Drag and drop
            zone.ondragover = (e) => {
                e.preventDefault();
                zone.style.transform = 'scale(1.02)';
                zone.style.borderColor = getColor(docType);
            };

            zone.ondragleave = () => {
                zone.style.transform = '';
            };

            zone.ondrop = (e) => {
                e.preventDefault();
                zone.style.transform = '';
                input.files = e.dataTransfer.files;
                handleFileUpload(docType, input.files[0], preview);
            };

            // File input change
            input.onchange = () => {
                if (input.files.length > 0) {
                    handleFileUpload(docType, input.files[0], preview);
                }
            };
        });

        function getColor(docType) {
            const colors = {
                aadhar: '#3b82f6',
                pan: '#10b981',
                voter: '#a855f7',
                ration: '#f97316'
            };
            return colors[docType] || '#3b82f6';
        }

        async function verifyDocumentType(docType, file) {
            // Document verification using Tesseract.js OCR
            return new Promise((resolve) => {
                const reader = new FileReader();

                reader.onload = async function(e) {
                    // Create an image to check
                    const img = new Image();
                    img.onload = async function() {
                        try {
                            // Create a canvas to analyze the image
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            canvas.width = img.width;
                            canvas.height = img.height;
                            ctx.drawImage(img, 0, 0);

                            // Get image data for analysis
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

                            // Simulate OCR text extraction (in production, use Tesseract.js or API)
                            // For now, we'll use a simpler color and pattern-based verification

                            const verification = await analyzeDocumentStructure(docType, canvas, imageData);
                            resolve(verification);

                        } catch (error) {
                            resolve({
                                valid: false,
                                message: 'Unable to verify document. Please ensure the image is clear and readable.'
                            });
                        }
                    };

                    img.onerror = function() {
                        resolve({
                            valid: false,
                            message: 'Unable to read image file. Please upload a valid image or PDF.'
                        });
                    };

                    if (file.type.includes('image')) {
                        img.src = e.target.result;
                    } else if (file.type.includes('pdf')) {
                        // For PDFs, accept by default (would need PDF.js for actual verification)
                        resolve({
                            valid: true,
                            message: ''
                        });
                    } else {
                        resolve({
                            valid: true,
                            message: ''
                        });
                    }
                };

                reader.onerror = function() {
                    resolve({
                        valid: false,
                        message: 'Unable to read file. Please try again.'
                    });
                };

                reader.readAsDataURL(file);
            });
        }

        async function analyzeDocumentStructure(docType, canvas, imageData) {
            // Analyze document based on expected patterns
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Expected document characteristics
            const documentPatterns = {
                aadhar: {
                    // Aadhar card characteristics:
                    // - Orange/saffron header stripe
                    // - Green "Government of India" text
                    // - QR code (bottom right or top right)
                    // - 12-digit UID number format: "0000 1111 2222"
                    // - Red bottom stripe with Hindi text
                    requiredFeatures: ['orange_header', 'green_text', 'qr_code', 'uid_number'],
                    colors: {
                        orange: {
                            r: [200, 255],
                            g: [100, 150],
                            b: [50, 100]
                        },
                        green: {
                            r: [0, 100],
                            g: [150, 255],
                            b: [0, 100]
                        },
                        red: {
                            r: [150, 255],
                            g: [0, 100],
                            b: [0, 100]
                        }
                    }
                },
                pan: {
                    // PAN card characteristics:
                    // - Blue background (light blue or purple)
                    // - "INCOME TAX DEPARTMENT" text
                    // - Government of India emblem
                    // - Photo on right side
                    // - Signature
                    // - PAN number format: "XXXXX0000X"
                    requiredFeatures: ['blue_background', 'govt_emblem', 'photo_area'],
                    colors: {
                        blue: {
                            r: [100, 200],
                            g: [180, 255],
                            b: [200, 255]
                        },
                        purple: {
                            r: [150, 220],
                            g: [100, 200],
                            b: [180, 255]
                        }
                    }
                },
                voter: {
                    // Voter ID characteristics:
                    // - State-specific colors
                    // - "ELECTION COMMISSION OF INDIA" text
                    // - Photo
                    // - EPIC number
                    // - Hologram/security features
                    requiredFeatures: ['photo_area', 'text_blocks'],
                    colors: {
                        // Various colors depending on state
                        multi: true
                    }
                },
                ration: {
                    // Ration card characteristics:
                    // - State-specific format
                    // - "RATION CARD" or state food dept
                    // - Family member details
                    // - Card number
                    requiredFeatures: ['text_blocks', 'structured_layout'],
                    colors: {
                        // Various colors depending on state
                        multi: true
                    }
                }
            };

            const pattern = documentPatterns[docType];
            if (!pattern) {
                return {
                    valid: true,
                    message: ''
                };
            }

            let detectedFeatures = 0;
            const requiredFeatures = pattern.requiredFeatures.length;

            // Analyze image for expected colors and patterns
            if (docType === 'aadhar') {
                // Check for orange header (top portion)
                const hasOrangeHeader = detectColorInRegion(imageData, width, height, 0, 0, width, height * 0.15, pattern.colors.orange);
                // Check for green text
                const hasGreenText = detectColorInRegion(imageData, width, height, 0, 0, width, height * 0.3, pattern.colors.green);
                // Check for red footer
                const hasRedFooter = detectColorInRegion(imageData, width, height, 0, height * 0.85, width, height, pattern.colors.red);
                // Check for QR code (dark dense area)
                const hasQRCode = detectDarkDenseRegion(imageData, width, height);

                if (hasOrangeHeader) detectedFeatures++;
                if (hasGreenText) detectedFeatures++;
                if (hasRedFooter) detectedFeatures++;
                if (hasQRCode) detectedFeatures++;

            } else if (docType === 'pan') {
                // Check for blue/purple background
                const hasBlueBackground = detectColorInRegion(imageData, width, height, 0, 0, width * 0.5, height, pattern.colors.blue) ||
                    detectColorInRegion(imageData, width, height, 0, 0, width * 0.5, height, pattern.colors.purple);
                // Check for photo area (right side, gray/white region)
                const hasPhotoArea = detectLightRegion(imageData, width, height, width * 0.6, height * 0.2, width, height * 0.6);

                if (hasBlueBackground) detectedFeatures += 2;
                if (hasPhotoArea) detectedFeatures++;

            } else {
                // For voter and ration cards, use generic document structure checks
                const hasStructuredLayout = detectTextRegions(imageData, width, height);
                const hasPhotoArea = detectLightRegion(imageData, width, height, width * 0.7, height * 0.2, width, height * 0.6);

                if (hasStructuredLayout) detectedFeatures += 2;
                if (hasPhotoArea) detectedFeatures++;
            }

            // Verify if enough features are detected
            const threshold = Math.max(2, Math.ceil(requiredFeatures * 0.5)); // At least 50% features or minimum 2
            const isValid = detectedFeatures >= threshold;

            return {
                valid: isValid,
                message: isValid ? '' : `This doesn't appear to be a valid ${docType.charAt(0).toUpperCase() + docType.slice(1)} card. Please ensure you're uploading the correct document with clear image quality.`
            };
        }

        function detectColorInRegion(imageData, width, height, x1, y1, x2, y2, colorRange) {
            const data = imageData.data;
            let matchCount = 0;
            let totalPixels = 0;

            for (let y = Math.floor(y1); y < Math.min(Math.floor(y2), height); y += 2) {
                for (let x = Math.floor(x1); x < Math.min(Math.floor(x2), width); x += 2) {
                    const i = (y * width + x) * 4;
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];

                    totalPixels++;

                    if (colorRange.r && colorRange.g && colorRange.b) {
                        if (r >= colorRange.r[0] && r <= colorRange.r[1] &&
                            g >= colorRange.g[0] && g <= colorRange.g[1] &&
                            b >= colorRange.b[0] && b <= colorRange.b[1]) {
                            matchCount++;
                        }
                    }
                }
            }

            return totalPixels > 0 && (matchCount / totalPixels) > 0.1; // 10% threshold
        }

        function detectDarkDenseRegion(imageData, width, height) {
            // Detect QR code or dark dense regions (like QR codes in Aadhar)
            const data = imageData.data;
            let darkPixels = 0;
            let totalSampled = 0;

            // Check multiple regions for QR code
            const regions = [{
                    x: width * 0.7,
                    y: height * 0.1,
                    w: width * 0.25,
                    h: height * 0.3
                }, // Top right
                {
                    x: width * 0.7,
                    y: height * 0.6,
                    w: width * 0.25,
                    h: height * 0.3
                } // Bottom right
            ];

            for (const region of regions) {
                darkPixels = 0;
                totalSampled = 0;

                for (let y = Math.floor(region.y); y < Math.min(Math.floor(region.y + region.h), height); y += 3) {
                    for (let x = Math.floor(region.x); x < Math.min(Math.floor(region.x + region.w), width); x += 3) {
                        const i = (y * width + x) * 4;
                        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;

                        totalSampled++;
                        if (brightness < 100) darkPixels++;
                    }
                }

                if (totalSampled > 0 && (darkPixels / totalSampled) > 0.3) {
                    return true; // Found dark dense region
                }
            }

            return false;
        }

        function detectLightRegion(imageData, width, height, x1, y1, x2, y2) {
            const data = imageData.data;
            let lightPixels = 0;
            let totalPixels = 0;

            for (let y = Math.floor(y1); y < Math.min(Math.floor(y2), height); y += 2) {
                for (let x = Math.floor(x1); x < Math.min(Math.floor(x2), width); x += 2) {
                    const i = (y * width + x) * 4;
                    const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;

                    totalPixels++;
                    if (brightness > 180) lightPixels++;
                }
            }

            return totalPixels > 0 && (lightPixels / totalPixels) > 0.3;
        }

        function detectTextRegions(imageData, width, height) {
            // Detect areas with structured text (edges and contrast)
            const data = imageData.data;
            let edgeCount = 0;
            let totalSampled = 0;

            for (let y = 0; y < height - 1; y += 3) {
                for (let x = 0; x < width - 1; x += 3) {
                    const i = (y * width + x) * 4;
                    const iRight = (y * width + (x + 1)) * 4;
                    const iDown = ((y + 1) * width + x) * 4;

                    const current = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    const right = (data[iRight] + data[iRight + 1] + data[iRight + 2]) / 3;
                    const down = (data[iDown] + data[iDown + 1] + data[iDown + 2]) / 3;

                    totalSampled++;
                    if (Math.abs(current - right) > 40 || Math.abs(current - down) > 40) {
                        edgeCount++;
                    }
                }
            }

            return totalSampled > 0 && (edgeCount / totalSampled) > 0.15;
        }

        async function handleFileUpload(docType, file, previewEl) {
            if (!file) return;

            const sizeKB = Math.round(file.size / 1024);
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
            const sizeDisplay = sizeKB > 1024 ? `${sizeMB} MB` : `${sizeKB} KB`;

            // Show loading state
            previewEl.innerHTML = `
        <div class="flex items-center gap-2 bg-blue-50 backdrop-blur p-2 rounded-lg animate-fadeInUp">
          <svg class="w-4 h-4 text-blue-600 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          <span class="text-sm text-gray-700">Verifying document...</span>
        </div>
      `;

            // Verify document type immediately
            const verification = await verifyDocumentType(docType, file);

            if (verification.valid) {
                uploadedDocs[docType] = file;
            } else {
                uploadedDocs[docType] = null;
            }

            // Update badge based on verification
            const badge = document.getElementById(`${docType}Badge`);
            if (badge) {
                if (verification.valid) {
                    // Green checkmark for valid document
                    badge.innerHTML = `
            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
            </svg>
          `;
                    badge.className = 'stats-badge bg-green-600 text-white px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-bold shadow';
                } else {
                    // Red X for invalid document
                    badge.innerHTML = `
            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          `;
                    badge.className = 'stats-badge bg-red-600 text-white px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-bold shadow';
                }
            }

            // Show file preview with validation status
            if (verification.valid) {
                previewEl.innerHTML = `
          <div class="flex items-center justify-between gap-2 bg-green-50 backdrop-blur p-2 rounded-lg border border-green-200 animate-fadeInUp">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <svg class="w-4 h-4 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="flex-1 truncate text-sm text-gray-800">${file.name}</span>
              <span class="text-gray-500 text-xs flex-shrink-0">${sizeDisplay}</span>
            </div>
            <button onclick="removeFile('${docType}')" class="remove-btn flex-shrink-0 bg-red-500 hover:bg-red-600 text-white p-1.5 rounded-lg transition transform hover:scale-110 active:scale-95" title="Remove file">
              <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        `;
            } else {
                previewEl.innerHTML = `
          <div class="flex flex-col gap-2 animate-fadeInUp">
            <div class="flex items-center justify-between gap-2 bg-red-50 backdrop-blur p-2 rounded-lg border border-red-200">
              <div class="flex items-center gap-2 flex-1 min-w-0">
                <svg class="w-4 h-4 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                <span class="flex-1 truncate text-sm text-gray-800">${file.name}</span>
                <span class="text-gray-500 text-xs flex-shrink-0">${sizeDisplay}</span>
              </div>
              <button onclick="removeFile('${docType}')" class="remove-btn flex-shrink-0 bg-red-500 hover:bg-red-600 text-white p-1.5 rounded-lg transition transform hover:scale-110 active:scale-95" title="Remove file">
                <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
            <p class="text-xs text-red-600 font-medium">⚠️ ${verification.message}</p>
          </div>
        `;
            }

            updateVerifyButton();
            statusMsg.innerHTML = "";
        }

        function removeFile(docType) {
            uploadedDocs[docType] = null;

            // Reset badge to show "4" with original color
            const badge = document.getElementById(`${docType}Badge`);
            if (badge) {
                badge.innerHTML = '4';
                // Reset to original color based on document type
                const colors = {
                    aadhar: 'bg-blue-600',
                    pan: 'bg-green-600',
                    voter: 'bg-purple-600',
                    ration: 'bg-orange-600'
                };
                const colorClass = colors[docType] || 'bg-blue-600';
                badge.className = `stats-badge ${colorClass} text-white px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-bold shadow`;
            }

            // Clear preview
            const preview = document.getElementById(`${docType}Preview`);
            if (preview) {
                preview.innerHTML = '';
            }

            // Reset file input
            const input = document.getElementById(`${docType}Input`);
            if (input) {
                input.value = '';
            }

            updateVerifyButton();
            statusMsg.innerHTML = "";
        }

        function updateVerifyButton() {
            const uploadCount = Object.values(uploadedDocs).filter(doc => doc !== null).length;
            const totalDocs = 4; // Total number of document types

            if (uploadCount === totalDocs) {
                // Show button only when all 4 documents are uploaded
                checkBtn.classList.remove('hidden');
                checkBtn.disabled = false;
                checkBtn.innerHTML = `
          <svg class="w-4 h-4 sm:w-5 sm:h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Verify All Documents
        `;
            } else {
                // Hide button if not all documents are uploaded
                checkBtn.classList.add('hidden');
                checkBtn.disabled = true;
            }
        }

        function verifyDocumentType(docType, fileName) {
            // Simple document type verification based on filename patterns
            const patterns = {
                aadhar: /aadhar|aadhaar|uid|uidai|adhaar/i,
                pan: /pan|permanent account|income tax/i,
                voter: /voter|election|epic|electoral/i,
                ration: /ration|food security|pds|public distribution/i
            };

            const pattern = patterns[docType];
            if (!pattern) return {
                valid: true,
                message: ''
            };

            // Check if filename contains expected keywords
            const isValid = pattern.test(fileName);

            return {
                valid: isValid,
                message: isValid ? '' : `This doesn't appear to be a ${docType.charAt(0).toUpperCase() + docType.slice(1)} card. Please upload the correct document.`
            };
        }

        checkBtn.onclick = () => {
                const uploadCount = Object.values(uploadedDocs).filter(doc => doc !== null).length;

                if (uploadCount === 0) {
                    statusMsg.innerHTML = `
          <div class="p-3 sm:p-4 bg-red-50 border border-red-200 rounded-xl animate-fadeInUp">
            <p class="text-red-700 font-semibold text-sm sm:text-base">⚠️ Please upload at least one document.</p>
          </div>
        `;
                    return;
                }

                // Show loading state
                checkBtn.disabled = true;
                checkBtn.innerHTML = `
        <svg class="w-4 h-4 sm:w-5 sm:h-5 inline-block mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Verifying...
      `;

                setTimeout(() => {
                            // Verify each document type
                            const verificationResults = [];
                            const invalidDocs = [];

                            Object.entries(uploadedDocs).forEach(([type, file]) => {
                                if (file !== null) {
                                    const verification = verifyDocumentType(type, file.name);
                                    if (verification.valid) {
                                        verificationResults.push(type.charAt(0).toUpperCase() + type.slice(1));
                                    } else {
                                        invalidDocs.push({
                                            type: type.charAt(0).toUpperCase() + type.slice(1),
                                            message: verification.message
                                        });
                                    }
                                }
                            });

                            // Display results
                            if (invalidDocs.length > 0) {
                                statusMsg.innerHTML = `
            <div class="p-3 sm:p-4 bg-red-50 border border-red-200 rounded-xl animate-fadeInUp">
              <p class="text-red-700 font-semibold text-sm sm:text-base">❌ Document Verification Failed</p>
              <ul class="text-xs sm:text-sm text-red-600 mt-2 space-y-1 list-disc list-inside">
                ${invalidDocs.map(doc => `<li><strong>${doc.type}:</strong> ${doc.message}</li>`).join('')}
              </ul>
              <p class="text-xs sm:text-sm text-red-600 mt-2">Please upload the correct documents and try again.</p>
            </div>
          `;
        } else {
          statusMsg.innerHTML = `
            <div class="p-3 sm:p-4 bg-emerald-50 border border-emerald-200 rounded-xl animate-fadeInUp">
              <p class="text-emerald-700 font-semibold text-sm sm:text-base">✅ All documents verified successfully!</p>
              <p class="text-xs sm:text-sm text-emerald-600 mt-2">
                Verified: ${verificationResults.join(', ')}
              </p>
              <p class="text-xs sm:text-sm text-emerald-600 mt-1">Your documents meet the requirements. You can proceed with your application.</p>
            </div>
          `;
        }
        
        checkBtn.disabled = false;
        updateVerifyButton();
      }, 1500);
    };

    checkBtn.disabled = true;
    </script>

</body>

</html>